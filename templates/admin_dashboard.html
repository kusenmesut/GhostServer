<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ghost Auditor - Yönetim Kokpiti</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body { background-color: #f1f2f7; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        /* Sol Menü */
        .sidebar { min-height: 100vh; background: #272c33; color: #fff; position: fixed; width: 250px; }
        .sidebar h3 { padding: 20px; background: #1b1e23; margin: 0; font-size: 1.2rem; text-align: center; color: #ffc107; }
        .sidebar a { color: #aeb2b7; display: block; padding: 15px 20px; text-decoration: none; border-bottom: 1px solid #30363d; transition: 0.3s; }
        .sidebar a:hover, .sidebar a.active { background: #30363d; color: #fff; border-left: 4px solid #ffc107; }
        .sidebar i { width: 25px; }
        
        /* Ana İçerik */
        .content { margin-left: 250px; padding: 25px; }
        .card-stat { border: none; border-radius: 5px; color: white; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .bg-blue { background: #007bff; }
        .bg-green { background: #28a745; }
        .bg-orange { background: #ffc107; color: #333; }
        .bg-red { background: #dc3545; }
        .stat-icon { font-size: 3rem; opacity: 0.3; position: absolute; right: 20px; top: 20px; }
        .stat-value { font-size: 2rem; font-weight: bold; }
        
        /* Form ve Tablo Kartları */
        .main-card { background: white; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); margin-bottom: 30px; }
        .card-header { background: white; border-bottom: 1px solid #eee; padding: 15px 20px; font-weight: bold; color: #2c3e50; }
        .card-body { padding: 20px; }
        .form-control:focus { border-color: #ffc107; box-shadow: 0 0 0 0.2rem rgba(255, 193, 7, 0.25); }
        .btn-ghost { background: #272c33; color: white; border: none; }
        .btn-ghost:hover { background: #1b1e23; color: #ffc107; }
    </style>
</head>
<body>

<div class="sidebar">
    <h3><i class="fas fa-ghost"></i> Ghost Admin</h3>
    <a href="#" class="active"><i class="fas fa-tachometer-alt"></i> Kokpit</a>
    <a href="#scenario-form"><i class="fas fa-code"></i> Senaryo Ekle</a>
    <a href="#"><i class="fas fa-users"></i> Kullanıcılar</a>
    <a href="#"><i class="fas fa-chart-line"></i> Loglar</a>
    <a href="/"><i class="fas fa-sign-out-alt"></i> Çıkış</a>
</div>

<div class="content">
    
    <div class="row">
        <div class="col-md-3">
            <div class="card-stat bg-blue">
                <div class="stat-value">{{ stats.users }}</div>
                <div>Toplam Kullanıcı</div>
                <i class="fas fa-users stat-icon"></i>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card-stat bg-green">
                <div class="stat-value">{{ stats.scenarios }}</div>
                <div>Aktif Senaryo</div>
                <i class="fas fa-file-code stat-icon"></i>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card-stat bg-orange">
                <div class="stat-value">{{ stats.revenue }}</div>
                <div>Toplam Kredi</div>
                <i class="fas fa-coins stat-icon"></i>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card-stat bg-red">
                <div class="stat-value">{{ stats.errors }}</div>
                <div>Sistem Hataları</div>
                <i class="fas fa-bug stat-icon"></i>
            </div>
        </div>
    </div>

    <div class="main-card" id="scenario-form">
        <div class="card-header">
            <i class="fas fa-plus-circle"></i> YENİ SENARYO OLUŞTUR
        </div>
        <div class="card-body">
            <form action="/admin/add-scenario" method="POST">
                <div class="form-row">
                    <div class="form-group col-md-4">
                        <label>Grup Adı (Menü)</label>
                        <select name="group_name" class="form-control">
                            <option>Kasa İşlemleri</option>
                            <option>Banka İşlemleri</option>
                            <option>Çek/Senet</option>
                            <option>Stok/Maliyet</option>
                            <option>Cari İşlemler</option>
                        </select>
                    </div>
                    <div class="form-group col-md-4">
                        <label>Risk Başlığı (Müşteri Görür)</label>
                        <input type="text" name="risk_title" class="form-control" placeholder="Örn: Ters Bakiye Kontrolü" required>
                    </div>
                    <div class="form-group col-md-4">
                        <label>Kaynak Veri</label>
                        <select name="source_type" class="form-control">
                            <option value="HAM VERI">HAM VERI (Yevmiye Defteri)</option>
                            <option value="MIZAN">MIZAN (Özet Tablo)</option>
                        </select>
                    </div>
                </div>

                <div class="form-group">
                    <label>Senaryo Açıklaması</label>
                    <input type="text" name="description" class="form-control" placeholder="Bu senaryo neyi denetler?">
                </div>

                <div class="form-group">
                    <label style="color:#d63031; font-weight:bold;">🐍 PYTHON KODU (Payload)</label>
                    <textarea name="code_payload" class="form-control" rows="6" style="font-family: monospace; background:#f8f9fa; border:1px solid #333;" placeholder="@PYTHON
# df (dataframe) değişkeni kullanıma hazırdır.
result_df = df[df['Bakiye'] < 0]"></textarea>
                    <small class="text-muted">Buraya yazdığınız kod şifrelenerek veritabanına kaydedilir.</small>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label>Risk Mesajı (Raporda Görünür)</label>
                        <input type="text" name="risk_message" class="form-control" placeholder="Örn: Kasa hesabı alacak bakiyesi veriyor.">
                    </div>
                    <div class="form-group col-md-6">
                        <label>Mevzuat Dayanağı</label>
                        <input type="text" name="legislation" class="form-control" placeholder="Örn: VUK Madde 359">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group col-md-6">
                        <label>Risk Nedeni</label>
                        <input type="text" name="risk_reason" class="form-control" placeholder="Hatalı muhasebe kaydı...">
                    </div>
                    <div class="form-group col-md-4">
                        <label>Çözüm Önerisi</label>
                        <input type="text" name="solution_suggestion" class="form-control" placeholder="Kayıtları düzeltin...">
                    </div>
                    <div class="form-group col-md-2">
                        <label>Maliyet (Kredi)</label>
                        <input type="number" name="cost_per_run" class="form-control" value="1">
                    </div>
                </div>

                <button type="submit" class="btn btn-ghost btn-block">💾 SENARYOYU KAYDET VE YAYINLA</button>
            </form>
        </div>
    </div>

    <div class="main-card">
        <div class="card-header">
            <i class="fas fa-list"></i> AKTİF SENARYOLAR
        </div>
        <div class="card-body p-0">
            <table class="table table-striped mb-0">
                <thead class="thead-dark">
                    <tr>
                        <th>ID</th>
                        <th>Grup</th>
                        <th>Başlık</th>
                        <th>Maliyet</th>
                        <th>Durum</th>
                    </tr>
                </thead>
                <tbody>
                    {% for scen in scenarios %}
                    <tr>
                        <td>{{ scen.id }}</td>
                        <td><span class="badge badge-info">{{ scen.group_name }}</span></td>
                        <td>{{ scen.risk_title }}</td>
                        <td>{{ scen.cost_per_run }} Kredi</td>
                        <td>
                            {% if scen.is_active %}
                            <span class="badge badge-success">Yayında</span>
                            {% else %}
                            <span class="badge badge-secondary">Pasif</span>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>

</body>
</html>